import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.c2ca2265.js";const h=JSON.parse('{"title":"Android安全开发规范手册","description":"","frontmatter":{},"headers":[],"relativePath":"android/index.md","filePath":"android/index.md","lastUpdated":1683282608000}'),e={name:"android/index.md"},p=l(`<h1 id="android安全开发规范手册" tabindex="-1">Android安全开发规范手册 <a class="header-anchor" href="#android安全开发规范手册" aria-label="Permalink to &quot;Android安全开发规范手册&quot;">​</a></h1><h2 id="manifest文件安全" tabindex="-1">manifest文件安全 <a class="header-anchor" href="#manifest文件安全" aria-label="Permalink to &quot;manifest文件安全&quot;">​</a></h2><h3 id="禁止permissiongroup的属性为空" tabindex="-1">禁止PermissionGroup的属性为空 <a class="header-anchor" href="#禁止permissiongroup的属性为空" aria-label="Permalink to &quot;禁止PermissionGroup的属性为空&quot;">​</a></h3><p>PermissionGroup可以对permission进行一个逻辑上的分组。如果PermissionGroup的属性为空，会导致权限定义无效，且其他app无法使用该权限。</p><h4 id="开发建议" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>设置PermissionGroup属性值或者不使用PermissionGroup。</p><h3 id="系统权限确认" tabindex="-1">系统权限确认 <a class="header-anchor" href="#系统权限确认" aria-label="Permalink to &quot;系统权限确认&quot;">​</a></h3><p>App如果使用一些系统限制权限，诸如android.permission.WRITE_SECURE_SETTINGS和android.permission.INSTALL_PACKAGES，则该app应该是设备自带的系统或google自带的app，并且应该放置在/system/app目录下。否则就是一个恶意app。 App使用下述权限，则该app有较高权限，要谨慎使用。</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">android.permission.MOUNT\\_FORMAT\\_FILESYSTEMS,</span></span>
<span class="line"><span style="color:#E1E4E8;">android.permission.MOUNT\\_UNMOUNT\\_FILESYSTEMS,</span></span>
<span class="line"><span style="color:#E1E4E8;">android.permission.RESTART\\_PACKAGES。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">android.permission.MOUNT\\_FORMAT\\_FILESYSTEMS,</span></span>
<span class="line"><span style="color:#24292E;">android.permission.MOUNT\\_UNMOUNT\\_FILESYSTEMS,</span></span>
<span class="line"><span style="color:#24292E;">android.permission.RESTART\\_PACKAGES。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="开发建议-1" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-1" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>根据业务需求，如非必要，移除该权限。</p><h3 id="protectionlevel属性设置" tabindex="-1">protectionLevel属性设置 <a class="header-anchor" href="#protectionlevel属性设置" aria-label="Permalink to &quot;protectionLevel属性设置&quot;">​</a></h3><p>由于对app的自定义permission的protectionLevel属性设置不当，会导致组件（如：content provider）数据泄露危险。最好的权限设置应为signature或signatureOrSystem，进而避免被第三方应用利用。</p><h4 id="开发建议-2" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-2" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>注意使用signature或signatureOrSystem防止其他app注册或接受该app的消息，提高安全性。</p><h3 id="合理设置shareduserid权限" tabindex="-1">合理设置sharedUserId权限 <a class="header-anchor" href="#合理设置shareduserid权限" aria-label="Permalink to &quot;合理设置sharedUserId权限&quot;">​</a></h3><p>通过sharedUserId，可以让拥有同一个User Id的多个apk运行在同一个进程中，互相访问任意资源。将sharedUserId设置为android.uid.system，可以把app放到系统进程中，app将获得极大的权限。如果app同时有master key漏洞，容易导致被root。</p><h4 id="开发建议-3" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-3" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>合理设置软件权限。</p><h3 id="设置allowbackup为false" tabindex="-1">设置allowBackup为false <a class="header-anchor" href="#设置allowbackup为false" aria-label="Permalink to &quot;设置allowBackup为false&quot;">​</a></h3><p>当这个标志被设置成true或不设置该标志位时，应用程序数据可以备份和恢复，adb调试备份允许恶意攻击者复制应用程序数据。</p><h4 id="开发建议-4" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-4" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>设置AndroidManifest.xml的android:allowBackup标志为false。</p><h4 id="影响范围" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>API &gt;= 8</p><h3 id="禁止debuggable为true" tabindex="-1">禁止Debuggable为true <a class="header-anchor" href="#禁止debuggable为true" aria-label="Permalink to &quot;禁止Debuggable为true&quot;">​</a></h3><p>在AndroidManifest.xml中定义Debuggable项，如果该项被打开，app存在被恶意程序调试的风险，可能导致泄露敏感信息等问题。</p><h4 id="开发建议-5" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-5" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>显示的设置AndroidManifest.xml的debuggable标志为false。</p><h2 id="组件安全" tabindex="-1">组件安全 <a class="header-anchor" href="#组件安全" aria-label="Permalink to &quot;组件安全&quot;">​</a></h2><h3 id="合理设置导出activity、activity-alias、service、receiver" tabindex="-1">合理设置导出Activity、activity-alias、service、receiver <a class="header-anchor" href="#合理设置导出activity、activity-alias、service、receiver" aria-label="Permalink to &quot;合理设置导出Activity、activity-alias、service、receiver&quot;">​</a></h3><p>Activity、activity-alias、service、receiver组件对外暴露会导致数据泄露和恶意的dos攻击。</p><h4 id="开发建议-6" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-6" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>最小化组件暴露。对不会参与跨应用调用的组件添加android:exported=false属性。</li><li>设置组件访问权限。对跨应用间调用的组件或者公开的receiver、service、activity和activity-alias设置权限，同时将权限的protectionLevel设置为signature或signatureOrSystem。</li><li>组件传输数据验证。对组件之间，特别是跨应用的组件之间的数据传入与返回做验证和增加异常处理，防止恶意调试数据传入，更要防止敏感数据返回。</li></ol><h3 id="contentprovider信息泄露风险" tabindex="-1">Contentprovider信息泄露风险 <a class="header-anchor" href="#contentprovider信息泄露风险" aria-label="Permalink to &quot;Contentprovider信息泄露风险&quot;">​</a></h3><p>provider组件导出可能会带来信息泄露隐患。api level在17以下的所有应用的android:exported属性默认值为true,17及以上默认值为false。</p><h4 id="开发建议-7" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-7" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>最小化组件暴露。对不会参与跨应用调用的组件添加android:exported=false属性。</li><li>设置组件访问权限。对导出的provider组件设置权限，同时将权限的protectionLevel设置为signature或signatureOrSystem。</li><li>由于Contentprovider无法在2（API-8）申明为私有。故建议将min sdk设为8以上。</li></ol><h4 id="影响范围-1" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围-1" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>api level在17以下的所有应用的android:exported属性默认值为true,17及以上默认值为false。</p><h3 id="严格过滤openfile对uri访问" tabindex="-1">严格过滤openFile对uri访问 <a class="header-anchor" href="#严格过滤openfile对uri访问" aria-label="Permalink to &quot;严格过滤openFile对uri访问&quot;">​</a></h3><p>该漏洞由于Content provider组件暴露，没有对Content provider组件访问权限进行限制且对Uri路径没有进行过滤，攻击者通过Content provider实现的OpenFile接口进行攻击，如通过../的方式访问任意的目录文件，造成隐私泄露。</p><h4 id="开发建议-8" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-8" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>将不必要导出的Content provider设置为不导出</li><li>由于Android组件Content provider无法在Android 2.2（即API Level 8）系统上设为不导出，因此如果应用的Content provider不必要导出，阿里聚安全建议声明最低SDK版本为8以上版本；</li><li>由于API level 在17以下的所有应用的android:exported属性默认值都为，因此如果应用的Content provider不必要导出，阿里聚安全建议显示设置注册的Content provider组件的android:exported属性为false；</li><li>去除没有必要的penFile()接口</li><li>如果应用的Content provider组件没有必要实现penFile()接口，阿里聚安全建议移除该Content provider的不必要的penFile()接口。</li><li>过滤限制跨域访问，对访问的目标文件的路径进行有效判断</li><li>使用decode()先对Content Query Uri进行解码后，再过滤如可通过../实现任意可读文件的访问的Uri字符串；</li><li>设置权限来进行内部应用通过Content provider的数据共享</li><li>使用签名验证来控制Content provider共享数据的访问权限，如设置protectionLevel=signature或signatureOrSystem；</li><li>公开的content provider确保不存储敏感数据</li><li>提供asset文件时注意权限保护</li></ol><h3 id="使用显式intent-调用bindservice" tabindex="-1">使用显式Intent 调用bindService() <a class="header-anchor" href="#使用显式intent-调用bindservice" aria-label="Permalink to &quot;使用显式Intent 调用bindService()&quot;">​</a></h3><p>创建隐式Intent 时，Android 系统通过将Intent 的内容与在设备上其他应用的清单文件中声明的Intent 过滤器进行比较，从而找到要启动的相应组件。如果Intent 与Intent 过滤器匹配，则系统将启动该组件，并将其传递给对象。如果多个Intent 过滤器兼容，则系统会显示一个对话框，支持用户选取要使用的应用。</p><p>为了确保应用的安全性，启动Service 时，请始终使用显式Intent，且不要为服务声明Intent 过滤器。使用隐式Intent 启动服务存在安全隐患，因为您无法确定哪些服务将响应Intent，且用户无法看到哪些服务已启动。从Android 5.0（API 级别21）开始，如果使用隐式Intent 调用bindService()，系统会抛出异常。</p><h4 id="开发建议-9" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-9" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>为了确保应用的安全性，启动 Service 时，请始终使用显式 Intent，且不要为服务声明 Intent 过滤器。使用隐式 Intent 启动服务存在安全隐患，因为您无法确定哪些服务将响应Intent，且用户无法看到哪些服务已启动。从 Android 5.0（API 级别 21）开始，如果使用隐式 Intent 调用 bindService()，系统会抛出异常。</p><h4 id="影响范围-2" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围-2" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>全部。从Android 5.0（API 级别21）开始，如果使用隐式Intent 调用bindService()，系统会抛出异常。</p><h3 id="合理处理intent-scheme-url" tabindex="-1">合理处理Intent Scheme URL <a class="header-anchor" href="#合理处理intent-scheme-url" aria-label="Permalink to &quot;合理处理Intent Scheme URL&quot;">​</a></h3><p>Intent Scheme URI是一种特殊的URL格式，用来通过Web页面启动已安装应用的Activity组件，大多数主流浏览器都支持此功能。</p><p>Android Browser的攻击手段——Intent Scheme URLs攻击。这种攻击方式利用了浏览器保护措施的不足，通过浏览器作为桥梁间接实现Intend-Based攻击。相比于普通Intend-Based攻击，这种方式极具隐蔽性，</p><p>如果在app中，没有检查获取到的load_url的值，攻击者可以构造钓鱼网站，诱导用户点击加载，就可以盗取用户信息。所以，对Intent URI的处理不当时，就会导致基于Intent的攻击。</p><p>如果浏览器支持Intent Scheme URI语法，一般会分三个步骤进行处理：</p><ol><li>利用parseUri解析uri，获取原始的intent对象；</li><li>对intent对象设置过滤规则；</li><li>通过startActivityIfNeeded或者startActivity发送intent；其中步骤2起关键作用，过滤规则缺失或者存在缺陷都会导致Intent Schem URL攻击。</li></ol><h4 id="关键点" tabindex="-1">关键点 <a class="header-anchor" href="#关键点" aria-label="Permalink to &quot;关键点&quot;">​</a></h4><p><code>Intent.parseUri</code>函数，通过扫描出所有调用了<code>Intent.parseUri</code>方法的路径，并检测是否使用如下的策略。 比较安全的使用<code>Intent Scheme URI</code>方法是：</p><p>如果使用了<code>Intent.parseUri</code>函数，获取的intent必须严格过滤，intent至少包含addCategory(android.intent.category.BROWSABLE)，setComponent(null)，setSelector(null)3个策略。</p><p>所以，在检的时候只要根据Intent.parseUri函数返回的Intent对象有没有按照以下方式实现即可做出判断：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// convert intent scheme URL to intent object</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Intent intent </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Intent.</span><span style="color:#B392F0;">parseUri</span><span style="color:#E1E4E8;">(uri);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// forbid launching activities without BROWSABLE category</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">intent.</span><span style="color:#B392F0;">addCategory</span><span style="color:#E1E4E8;">(android.intent.category.BROWSABLE);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// forbid explicit call</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">intent.</span><span style="color:#B392F0;">setComponent</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// forbid intent with selector intent  intent.setSelector(null);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// start the activity by the intent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">context.</span><span style="color:#B392F0;">startActivityIfNeeded</span><span style="color:#E1E4E8;">(intent, </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// convert intent scheme URL to intent object</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Intent intent </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Intent.</span><span style="color:#6F42C1;">parseUri</span><span style="color:#24292E;">(uri);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">// forbid launching activities without BROWSABLE category</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">intent.</span><span style="color:#6F42C1;">addCategory</span><span style="color:#24292E;">(android.intent.category.BROWSABLE);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// forbid explicit call</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">intent.</span><span style="color:#6F42C1;">setComponent</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">// forbid intent with selector intent  intent.setSelector(null);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// start the activity by the intent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">context.</span><span style="color:#6F42C1;">startActivityIfNeeded</span><span style="color:#24292E;">(intent, </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="开发建议-10" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-10" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>如果使用了Intent.parseUri函数，获取的intent必须严格过滤，intent至少包含addCategory(android.intent.category.BROWSABLE)，setComponent(null)，setSelector(null)3个策略。除了以上做法，最佳处理不要信任任何来自网页端的任何intent，为了安全起见，使用网页传过来的intent时，要进行过滤和检查</p><h3 id="本地拒绝服务" tabindex="-1">本地拒绝服务 <a class="header-anchor" href="#本地拒绝服务" aria-label="Permalink to &quot;本地拒绝服务&quot;">​</a></h3><p>Android系统提供了Activity、Service和Broadcast Receiver等组件，并提供了Intent机制来协助应用间的交互与通讯，Intent负责对应用中一次操作的动作、动作涉及数据、附加数据进行描述，Android系统则根据此Intent的描述，负责找到对应的组件，将Intent传递给调用的组件，并完成组件的调用。Android应用本地拒绝服务漏洞源于程序没有对Intent.GetXXXExtra()获取的异常或者畸形数据处理时没有进行异常捕获，从而导致攻击者可通过向受害者应用发送此类空数据、异常或者畸形数据来达到使该应用Crash的目的，简单的说就是攻击者通过Intent发送空数据、异常或畸形数据给受害者应用，导致其崩溃。</p><p>对导出的组件传递一个不存在的序列化对象，若没有try...catch捕获异常就会崩溃</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ComponentName cn </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ComponentName</span><span style="color:#E1E4E8;">(com.test, com.test.TargetActivity)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Intent i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Intent</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">i.</span><span style="color:#B392F0;">setComponentName</span><span style="color:#E1E4E8;">(cn)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">i.</span><span style="color:#B392F0;">putExtra</span><span style="color:#E1E4E8;">(key, </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CustomSeriable</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">startActivity</span><span style="color:#E1E4E8;">(i)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">**public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DataSchema</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">implements</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Serializable</span><span style="color:#E1E4E8;"> {</span><span style="color:#F97583;">**</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DataSchema</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">super</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ComponentName cn </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ComponentName</span><span style="color:#24292E;">(com.test, com.test.TargetActivity)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Intent i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Intent</span><span style="color:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">i.</span><span style="color:#6F42C1;">setComponentName</span><span style="color:#24292E;">(cn)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">i.</span><span style="color:#6F42C1;">putExtra</span><span style="color:#24292E;">(key, </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CustomSeriable</span><span style="color:#24292E;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">startActivity</span><span style="color:#24292E;">(i)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">**public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DataSchema</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">implements</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Serializable</span><span style="color:#24292E;"> {</span><span style="color:#D73A49;">**</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DataSchema</span><span style="color:#24292E;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="nullpointerexception-异常导致的拒绝服务" tabindex="-1">NullPointerException 异常导致的拒绝服务 <a class="header-anchor" href="#nullpointerexception-异常导致的拒绝服务" aria-label="Permalink to &quot;NullPointerException 异常导致的拒绝服务&quot;">​</a></h3><p>源于程序没有对getAction()等获取到的数据进行空指针判断，从而导致了空指针异常导致应用崩溃</p><h4 id="风险代码" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Intent i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Intent</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (i.</span><span style="color:#B392F0;">getAction</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">equals</span><span style="color:#E1E4E8;">(TestForNullPointerException)) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    Log.</span><span style="color:#B392F0;">d</span><span style="color:#E1E4E8;">(TAG, Test </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> Android Refuse Service Bug);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Intent i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Intent</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (i.</span><span style="color:#6F42C1;">getAction</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">equals</span><span style="color:#24292E;">(TestForNullPointerException)) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    Log.</span><span style="color:#6F42C1;">d</span><span style="color:#24292E;">(TAG, Test </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> Android Refuse Service Bug);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="classcastexception-异常导致的拒绝服务" tabindex="-1">ClassCastException 异常导致的拒绝服务 <a class="header-anchor" href="#classcastexception-异常导致的拒绝服务" aria-label="Permalink to &quot;ClassCastException 异常导致的拒绝服务&quot;">​</a></h3><p>源于程序没有对getSerializableExtra()等获取到的数据进行类型判断而进行强制类型转换，从而导致类型转换异常导致拒绝服务漏洞</p><h4 id="风险代码-1" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-1" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Intent i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getIntent</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">String test </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (String) i.</span><span style="color:#B392F0;">getSerializableExtra</span><span style="color:#E1E4E8;">(serializable\\_key);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">IndexOutOfBoundsException 异常导致拒绝服务漏洞</span><span style="color:#F97583;">**</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Intent i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getIntent</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">String test </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (String) i.</span><span style="color:#6F42C1;">getSerializableExtra</span><span style="color:#24292E;">(serializable\\_key);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">**</span><span style="color:#24292E;">IndexOutOfBoundsException 异常导致拒绝服务漏洞</span><span style="color:#D73A49;">**</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>源于程序没有对getIntegerArrayListExtra()等获取到的数据数组元素大小判断，导致数组访问越界而造成拒绝服务漏洞</p><h4 id="风险代码-2" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-2" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Intent intent </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getIntent</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">ArrayList&lt;</span><span style="color:#F97583;">Integer</span><span style="color:#E1E4E8;">&gt; intArray </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> intent.</span><span style="color:#B392F0;">getIntegerArrayListExtra</span><span style="color:#E1E4E8;">(user\\_id);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (intArray </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        intArray.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(i);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Intent intent </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getIntent</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">ArrayList&lt;</span><span style="color:#D73A49;">Integer</span><span style="color:#24292E;">&gt; intArray </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> intent.</span><span style="color:#6F42C1;">getIntegerArrayListExtra</span><span style="color:#24292E;">(user\\_id);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (intArray </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        intArray.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(i);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="classnotfoundexception-异常导致的拒绝服务漏洞" tabindex="-1">ClassNotFoundException 异常导致的拒绝服务漏洞 <a class="header-anchor" href="#classnotfoundexception-异常导致的拒绝服务漏洞" aria-label="Permalink to &quot;ClassNotFoundException 异常导致的拒绝服务漏洞&quot;">​</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Intent i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getIntent</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">getSerializableExtra</span><span style="color:#E1E4E8;">(key);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Intent i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getIntent</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">getSerializableExtra</span><span style="color:#24292E;">(key);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="开发建议-11" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-11" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>将比不要导出的组建设置为不导出</p><p>在处理Intent数据时，进行捕获异常，通过getXXXExtra()获取的数据时进行以下判断，以及用try catch方式捕获所有异常，防止出现拒绝服务漏洞，包括：空指针异常、类型转换异常、数组越界访问异常、类未定义异常、其他异常</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">try</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    ....</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">xxx.</span><span style="color:#B392F0;">getXXXExtra</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">....</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}Catch Exception{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">**</span><span style="color:#6A737D;">// 为空即可**</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">try</span><span style="color:#24292E;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    ....</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">xxx.</span><span style="color:#6F42C1;">getXXXExtra</span><span style="color:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">....</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}Catch Exception{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">**</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">**</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">**</span><span style="color:#6A737D;">// 为空即可**</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="合理定义android-intent-category-browsable" tabindex="-1">合理定义android.intent.category.BROWSABLE <a class="header-anchor" href="#合理定义android-intent-category-browsable" aria-label="Permalink to &quot;合理定义android.intent.category.BROWSABLE&quot;">​</a></h3><p>在AndroidManifest文件中定义了android.intent.category.BROWSABLE属性的组件，可以通过浏览器唤起，这会导致远程命令执行漏洞攻击</p><h4 id="开发建议-12" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-12" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>APP中任何接收外部输入数据的地方都是潜在的攻击点，过滤检查来自网页的参数</li><li>不要通过网页传输敏感信息，有的网站为了引导已经登录的用户到APP上使用，会使用脚本动态的生成URL Scheme的参数，其中包括了用户名、密码或者登录态token等敏感信息，让用户打开APP直接就登录了。恶意应用也可以注册相同的URL Sechme来截取这些敏感信息。Android系统会让用户选择使用哪个应用打开链接，但是如果用户不注意，就会使用恶意应用打开，导致敏感信息泄露或者其他风险。</li></ol><h3 id="删除debug和test信息" tabindex="-1">删除Debug和Test信息 <a class="header-anchor" href="#删除debug和test信息" aria-label="Permalink to &quot;删除Debug和Test信息&quot;">​</a></h3><p>一些app在正式发布前，为了方便调试app，都会在app里集成一些调试或测试界面。这些测试界面可能包含敏感的信息。</p><h4 id="开发建议-13" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-13" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>在正式发布前移除所有的测试组件</p><h3 id="intent不安全反射风险" tabindex="-1">Intent不安全反射风险 <a class="header-anchor" href="#intent不安全反射风险" aria-label="Permalink to &quot;Intent不安全反射风险&quot;">​</a></h3><p>通过Intent接收的Extra参数来构造反射对象会导致从不受信任的源加载类。攻击者可以通过巧妙地构造达到加载其它类的目的 两个关键函数，分别是：getIntent()和Class.forName(....)</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecondActivity</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Activity</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        @</span><span style="color:#F97583;">Override</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onCreate</span><span style="color:#E1E4E8;">(Bundle </span><span style="color:#FFAB70;">savedInstanceState</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">super</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onCreate</span><span style="color:#E1E4E8;">(savedInstanceState);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">setContentView</span><span style="color:#E1E4E8;">(R.layout.activity\\_second);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                Intent intent </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getIntent</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                String className </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> intent.</span><span style="color:#B392F0;">getStringExtra</span><span style="color:#E1E4E8;">(className);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                String methodName </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> intent.</span><span style="color:#B392F0;">getStringExtra</span><span style="color:#E1E4E8;">(methodName);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                        Class&lt;</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;">&gt; clz </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                        clz </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Class.</span><span style="color:#B392F0;">forName</span><span style="color:#E1E4E8;">(className);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                        Date object </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (Date) clz.</span><span style="color:#B392F0;">newInstance</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                        Method method </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> clz.</span><span style="color:#B392F0;">getMethod</span><span style="color:#E1E4E8;">(methodName);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                        Toast.</span><span style="color:#B392F0;">makeText</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">getApplicationContext</span><span style="color:#E1E4E8;">(), method.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">(object, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">======</span><span style="color:#E1E4E8;">, Toast.LENGTH\\_LONG).</span><span style="color:#B392F0;">show</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (Exception </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                        e.</span><span style="color:#B392F0;">printStackTrace</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecondActivity</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Activity</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onCreate</span><span style="color:#24292E;">(Bundle </span><span style="color:#E36209;">savedInstanceState</span><span style="color:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">onCreate</span><span style="color:#24292E;">(savedInstanceState);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">setContentView</span><span style="color:#24292E;">(R.layout.activity\\_second);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                Intent intent </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getIntent</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                String className </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> intent.</span><span style="color:#6F42C1;">getStringExtra</span><span style="color:#24292E;">(className);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                String methodName </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> intent.</span><span style="color:#6F42C1;">getStringExtra</span><span style="color:#24292E;">(methodName);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                        Class&lt;</span><span style="color:#D73A49;">?</span><span style="color:#24292E;">&gt; clz </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                        clz </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Class.</span><span style="color:#6F42C1;">forName</span><span style="color:#24292E;">(className);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                        Date object </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (Date) clz.</span><span style="color:#6F42C1;">newInstance</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                        Method method </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> clz.</span><span style="color:#6F42C1;">getMethod</span><span style="color:#24292E;">(methodName);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                        Toast.</span><span style="color:#6F42C1;">makeText</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">getApplicationContext</span><span style="color:#24292E;">(), method.</span><span style="color:#6F42C1;">invoke</span><span style="color:#24292E;">(object, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">======</span><span style="color:#24292E;">, Toast.LENGTH\\_LONG).</span><span style="color:#6F42C1;">show</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                        e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>逆向后对应的smali代码如下：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">invoke</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">virtual {p0}, Lcom</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bug</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">intent</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">reflection</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">SecondActivity;</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">getIntent</span><span style="color:#E1E4E8;">()Landroid</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">content</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Intent;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">invoke</span><span style="color:#F97583;">-static</span><span style="color:#E1E4E8;"> {v0}, Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Class;</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">forName</span><span style="color:#E1E4E8;">(Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">String;)Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Class;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">invoke</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">virtual {p0}, Lcom</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">bug</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">intent</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">reflection</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">SecondActivity;</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">getIntent</span><span style="color:#24292E;">()Landroid</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">content</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Intent;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">invoke</span><span style="color:#D73A49;">-static</span><span style="color:#24292E;"> {v0}, Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Class;</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">forName</span><span style="color:#24292E;">(Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">String;)Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Class;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="开发建议-14" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-14" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>不要通过Intent接收的Extra传播的反射函数</li><li>将接受反射的组件设置为非导出组件</li></ol><h2 id="webview组件安全" tabindex="-1">webview组件安全 <a class="header-anchor" href="#webview组件安全" aria-label="Permalink to &quot;webview组件安全&quot;">​</a></h2><h3 id="webview远程执行漏洞" tabindex="-1">WebView远程执行漏洞 <a class="header-anchor" href="#webview远程执行漏洞" aria-label="Permalink to &quot;WebView远程执行漏洞&quot;">​</a></h3><p>和WebView远程代码执行相关的漏洞主要有CVE-2012-6336,CVE-2014-1939,CVE-2014-7224, 这些漏洞中最核心的漏洞是CVE-2012-6336，另外两个CVE只是发现了几个默认存在的接口。</p><p>Android API &lt; 17之前版本存在远程代码执行安全漏洞，该漏洞源于程序没有正确限制使用addJavaScriptInterface(CVE-2012-6636)方法，攻击者可以通过Java反射利用该漏洞执行任意Java对象的方法，导致远程代码执行安全漏洞除。</p><h4 id="开发建议-15" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-15" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>API等于高于17的Android系统。出于安全考虑，为了防止Java层的函数被随意调用，Google在2版本之后，规定允许被调用的函数必须以@JavascriptInterface进行注解。</li><li>API等于高于17的Android系统。建议不要使用addJavascriptInterface接口，以免带来不必要的安全隐患，如果一定要使用该接口：</li><li>如果使用https协议加载url，应用进行证书校验防止访问的页面被篡改挂马</li><li>如果使用http协议加载url，应进行白名单过滤、完整性校验等防止访问的页面被篡改</li><li>如果加载本地html，应将html文件内置在apk中，以及进行对html页面完整性的校验</li><li>使用removeJavascriptInterface移除Android系统内部的默认内置接口：searchBoxJavaBridge_、accessibility、accessibilityTraversal</li></ol><h4 id="范围" tabindex="-1">范围： <a class="header-anchor" href="#范围" aria-label="Permalink to &quot;范围：&quot;">​</a></h4><ul><li>CVE-2012-6636</li></ul><p>Android API 16.0及之前的版本中存在安全漏洞，该漏洞源于程序没有正确限制使用WebView.addJavascriptInterface方法。远程攻击者可通过使用Java Reflection API利用该漏洞执行任意Java对象的方法 Google Android &lt;= 4.1.2 (API level 16) 受到此漏洞的影响。</p><ul><li>CVE-2014-1939</li></ul><p>java/android/webkit/BrowserFrame.java 使用addJavascriptInterface API并创建了SearchBoxImpl类的对象。攻击者可通过访问searchBoxJavaBridge_接口利用该漏洞执行任意Java代码。</p><p>Google Android &lt;= 4.3.1 受到此漏洞的影响</p><ul><li>CVE-2014-7224</li></ul><p>香港理工大学的研究人员发现当系统辅助功能中的任意一项服务被开启后，所有由系统提供的WebView都会被加入两个JS objects，分别为是accessibility和accessibilityTraversal。恶意攻击者就可以使用accessibility和accessibilityTraversal这两个Java Bridge来执行远程攻击代码.</p><p>Google Android &lt; 4.4 受到此漏洞的影响。</p><h3 id="webview潜在xss攻击" tabindex="-1">WebView潜在XSS攻击 <a class="header-anchor" href="#webview潜在xss攻击" aria-label="Permalink to &quot;WebView潜在XSS攻击&quot;">​</a></h3><p>允许WebView执行JavaScript(setJavaScriptEnabled)，有可能导致XSS攻击。</p><h4 id="开发建议-16" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-16" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>应尽量避免使用。如果一定要使用：</p><ol><li>API等于高高于17的Android系统。出于安全考虑，为了防止Java层的函数被随意调用，Google在2版本之后，规定允许被调用的函数必须以@JavascriptInterface进行注解。</li><li>API等于高高于17的Android系统。建议不要使用addJavascriptInterface接口，一面带来不必要的安全隐患，如果一定要使用该接口：</li><li>如果使用https协议加载url，应用进行证书校验防止访问的页面被篡改挂马</li><li>如果使用http协议加载url，应进行白名单过滤、完整性校验等防止访问的页面被篡改</li><li>如果加载本地html，应将html文件内置在apk中，以及进行对html页面完整性的校验</li><li>使用removeJavascriptInterface移除Android系统内部的默认内置接口：searchBoxJavaBridge_、accessibility、accessibilityTraversal</li></ol><h4 id="影响范围-3" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围-3" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>Android api &lt;17</p><h3 id="webview-file域同源策略绕过" tabindex="-1">WebView File域同源策略绕过 <a class="header-anchor" href="#webview-file域同源策略绕过" aria-label="Permalink to &quot;WebView File域同源策略绕过&quot;">​</a></h3><p>应用程序一旦使用WebView并支持File域，就会受到该漏洞的攻击。该漏洞源于：JavaScript的延时执行能够绕过file协议的同源检查，并能够访问受害应用的所有私有文件，即通过WebView对Javascript的延时执行和将当前Html文件删除掉并软连接指向其他文件就可以读取到被符号链接所指的文件，然后通过JavaScript再次读取HTML文件，即可获取到被符号链接所指的文件。</p><p>大多数使用WebView的应用都会受到该漏洞的影响，恶意应用通过该漏洞，可在无特殊权限下盗取应用的任意私有文件，尤其是浏览器，可通过利用该漏洞，获取到浏览器所保存的密码、Cookie、收藏夹以及历史记录等敏感信息，从而造成敏感信息泄露。</p><h4 id="开发建议-17" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-17" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>将不必要导出的组件设置为不导出</li></ol><p>如果应用的组件不必要导出，建议显式设置所注册组件的android:exported属性为false；</p><ol start="2"><li>如果需要导出组件，禁止使用File域</li></ol><p>如果应用的需要导出包含WebView的组件，建议禁止使用File域协议：</p><p>myWebView.getSettings. setAllowFileAccess(false);</p><ol start="3"><li>如果需要使用File协议，禁止File协议调用JavaScript</li></ol><p>如果应用的WebView需要使用File域协议，建议禁止File域协议调用JavaScript：</p><p>myWebView.getSettings. setJavaScriptEnabled(false);</p><h3 id="禁止webview密码明文存储" tabindex="-1">禁止webview密码明文存储 <a class="header-anchor" href="#禁止webview密码明文存储" aria-label="Permalink to &quot;禁止webview密码明文存储&quot;">​</a></h3><p>webview的保存密码功能默认设置为true。Webview会明文保存网站上的密码到本地私有文件databases/webview.db中。对于可以被root的系统环境或者配合其他漏洞（如webview的同源绕过漏洞），攻击者可以获取到用户密码。</p><h4 id="开发建议-18" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-18" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>显示设置webView.getSetting().setSavePassword(false)</p><h3 id="主机名弱校验漏洞" tabindex="-1">主机名弱校验漏洞 <a class="header-anchor" href="#主机名弱校验漏洞" aria-label="Permalink to &quot;主机名弱校验漏洞&quot;">​</a></h3><p>自定义HostnameVerifier类，却不实现verify方法验证域名，导致中间人攻击漏洞。</p><h4 id="开发建议-19" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-19" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>自定义HostnameVerifier类并实现verify方法验证域名。</p><h3 id="证书弱校验漏洞" tabindex="-1">证书弱校验漏洞 <a class="header-anchor" href="#证书弱校验漏洞" aria-label="Permalink to &quot;证书弱校验漏洞&quot;">​</a></h3><p>App在实现X509TrustManager时，默认覆盖google默认的证书检查机制方法：checkClientTrusted、checkServerTrusted和getAcceptedIssuers，会导致中间人攻击漏洞。</p><h4 id="开发建议-20" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-20" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>如果自己创建X509Certificate，则在覆盖checkClientTrusted、checkServerTrusted和getAcceptedIssuers后要进行校验。</p><h3 id="中间人攻击漏洞" tabindex="-1">中间人攻击漏洞 <a class="header-anchor" href="#中间人攻击漏洞" aria-label="Permalink to &quot;中间人攻击漏洞&quot;">​</a></h3><p>App调用setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER)，信任所有主机名，会导致中间人攻击。</p><h4 id="开发建议-21" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-21" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>查找所有设置了ALLOW_ALL_HOSTNAME_VERIFIER字段属性的方法路径；对信任的主机严格认证</p><h3 id="webview不校验证书漏洞" tabindex="-1">WebView不校验证书漏洞 <a class="header-anchor" href="#webview不校验证书漏洞" aria-label="Permalink to &quot;WebView不校验证书漏洞&quot;">​</a></h3><p>Android WebView组件加载网页发生证书认证错误时，会调用WebViewClient类的onReceivedSslError方法，如果该方法实现调用了handler.proceed()来忽略该证书错误，则会受到中间人攻击的威胁，可能导致隐私泄露。</p><p>自定义实现的WebViewClient类在onReceivedSslError是否调用proceed()方法。</p><h4 id="开发建议-22" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-22" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>当发生证书认证错误时，采用默认的处理方法handler.cancel()，停止加载问题页面当发生证书认证错误时，采用默认的处理方法handler.cancel()，停止加载问题页面</p><h3 id="webview组件系统隐藏接口未移除" tabindex="-1">WebView组件系统隐藏接口未移除 <a class="header-anchor" href="#webview组件系统隐藏接口未移除" aria-label="Permalink to &quot;WebView组件系统隐藏接口未移除&quot;">​</a></h3><p>android webview组件包含3个隐藏的系统接口：searchBoxJavaBridge_,accessibilityTraversal以及accessibility，恶意程序可以利用它们实现远程代码执行。</p><h4 id="风险代码-3" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-3" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const-</span><span style="color:#E1E4E8;">string v3, searchBoxJavaBridge\\_</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">invoke</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">virtual {v1, v3}, Landroid</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">webkit</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">WebView;</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">removeJavascriptInterface</span><span style="color:#E1E4E8;">(Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">String;)V</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const-</span><span style="color:#E1E4E8;">string v3, accessibility</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">invoke</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">virtual {v1, v3}, Landroid</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">webkit</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">WebView;</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">removeJavascriptInterface</span><span style="color:#E1E4E8;">(Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">String;)V</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const-</span><span style="color:#E1E4E8;">string v3, accessibilityTraversal</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">invoke</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">virtual {v1, v3}, Landroid</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">webkit</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">WebView;</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">removeJavascriptInterface</span><span style="color:#E1E4E8;">(Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">String;)V</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const-</span><span style="color:#24292E;">string v3, searchBoxJavaBridge\\_</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">invoke</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">virtual {v1, v3}, Landroid</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">webkit</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">WebView;</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">removeJavascriptInterface</span><span style="color:#24292E;">(Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">String;)V</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const-</span><span style="color:#24292E;">string v3, accessibility</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">invoke</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">virtual {v1, v3}, Landroid</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">webkit</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">WebView;</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">removeJavascriptInterface</span><span style="color:#24292E;">(Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">String;)V</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const-</span><span style="color:#24292E;">string v3, accessibilityTraversal</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">invoke</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">virtual {v1, v3}, Landroid</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">webkit</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">WebView;</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">removeJavascriptInterface</span><span style="color:#24292E;">(Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">String;)V</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="开发建议-23" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-23" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>使用了WebView，那么使用WebView.removeJavascriptInterface(String name) API，显示的移除searchBoxJavaBridge_、accessibility、accessibilityTraversal这三个接口</p><h4 id="影响范围-4" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围-4" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>4.0~4.4(不包含)</p><h2 id="sqlite安全" tabindex="-1">sqlite安全 <a class="header-anchor" href="#sqlite安全" aria-label="Permalink to &quot;sqlite安全&quot;">​</a></h2><h3 id="sqlite-sql注入漏洞" tabindex="-1">SQLite sql注入漏洞 <a class="header-anchor" href="#sqlite-sql注入漏洞" aria-label="Permalink to &quot;SQLite sql注入漏洞&quot;">​</a></h3><p>SQLite做为android平台的数据库，对于数据库查询，如果开发者采用字符串链接方式构造sql语句，就会产生sql注入。</p><h4 id="开发建议-24" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-24" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>provider不需要导出，请将export属性设置为false</li><li>若导出仅为内部通信使用，则设置protectionLevel=signature</li><li>不直接使用传入的查询语句用于projection和selection，使用由query绑定的参数selectionArgs</li><li>完备的SQL注入语句检测逻辑</li></ol><h3 id="databases任意读写漏洞" tabindex="-1">Databases任意读写漏洞 <a class="header-anchor" href="#databases任意读写漏洞" aria-label="Permalink to &quot;Databases任意读写漏洞&quot;">​</a></h3><p>APP在使用openOrCreateDatabase创建数据库时，将数据库设置了全局的可读权限，攻击者恶意读取数据库内容，获取敏感信息。在设置数据库属性时如果设置全局可写，攻击者可能会篡改、伪造内容，可以能会进行诈骗等行为，造成用户财产损失。</p><h4 id="开发建议-25" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-25" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>用MODE_PRIVATE模式创建数据库</li><li>使用sqlcipher等工具加密数据库</li><li>避免在数据库中存储明文和敏感信息</li></ol><h2 id="网络通信安全" tabindex="-1">网络通信安全 <a class="header-anchor" href="#网络通信安全" aria-label="Permalink to &quot;网络通信安全&quot;">​</a></h2><h3 id="ssl不安全组件" tabindex="-1">SSL不安全组件 <a class="header-anchor" href="#ssl不安全组件" aria-label="Permalink to &quot;SSL不安全组件&quot;">​</a></h3><p>SSLCertificateSocketFactory#getInsecure方法无法执行SSL验证检查，使得网络通信遭受中间人攻击。</p><h4 id="开发建议-26" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-26" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>移除SSLCertificateSocketFactory#getInsecure方法。</p><h3 id="httphost安全" tabindex="-1">HttpHost安全 <a class="header-anchor" href="#httphost安全" aria-label="Permalink to &quot;HttpHost安全&quot;">​</a></h3><p>HttpHost target = new HttpHost(uri.getHost(), uri.getPort(), HttpHost.DEFAULT_SCHEME_NAME); HttpHost.DEFAULT_SCHEME_NAME默认是http，不安全。</p><h4 id="开发建议-27" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-27" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>改成使用https</p><h3 id="httpurlconnection漏洞" tabindex="-1">HttpURLConnection漏洞 <a class="header-anchor" href="#httpurlconnection漏洞" aria-label="Permalink to &quot;HttpURLConnection漏洞&quot;">​</a></h3><p>在Android 2.2版本之前，HttpURLConnection一直存在着一些令人厌烦的bug。比如说对一个可读的InputStream调用close()方法时，就有可能会导致连接池失效了。</p><h4 id="开发建议-28" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-28" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>判断Android版本，并设置http.keepAlive为false。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">disableConnectionReuseIfNecessary</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Work around pre-Froyo bugs in HTTP connection reuse.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (Integer.</span><span style="color:#B392F0;">parseInt</span><span style="color:#E1E4E8;">(Build.VERSION.SDK) </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> Build.VERSION\\_CODES.FROYO) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                System.</span><span style="color:#B392F0;">setProperty</span><span style="color:#E1E4E8;">(http.keepAlive, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">disableConnectionReuseIfNecessary</span><span style="color:#24292E;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Work around pre-Froyo bugs in HTTP connection reuse.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (Integer.</span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(Build.VERSION.SDK) </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> Build.VERSION\\_CODES.FROYO) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                System.</span><span style="color:#6F42C1;">setProperty</span><span style="color:#24292E;">(http.keepAlive, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="影响范围-5" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围-5" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>2.2版本之前</p><h2 id="弱加密风险检测" tabindex="-1">弱加密风险检测 <a class="header-anchor" href="#弱加密风险检测" aria-label="Permalink to &quot;弱加密风险检测&quot;">​</a></h2><h3 id="禁止使用弱加密算法" tabindex="-1">禁止使用弱加密算法 <a class="header-anchor" href="#禁止使用弱加密算法" aria-label="Permalink to &quot;禁止使用弱加密算法&quot;">​</a></h3><p>安全性要求高的应用程序必须避免使用不安全的或者强度弱的加密算法，现代计算机的计算能力使得攻击者通过暴力破解可以攻破强度弱的算法。例如，数据加密标准算法DES(密钥默认是56位长度、算法半公开、迭代次数少)是极度不安全的，使用类似EFF（Electronic Frontier Foundaton）Deep Crack的计算机在一天内可以暴力破解由DES加密的消息。</p><p>使用DES弱加密算法，样例</p><h4 id="风险代码-4" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-4" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">SecretKeySpec key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecretKeySpec</span><span style="color:#E1E4E8;">(rawKeyData, DES);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Cipher cipher </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Cipher.</span><span style="color:#B392F0;">getInstance</span><span style="color:#E1E4E8;">(DES</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ECB</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">PKCS5Padding);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">cipher.</span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;">(Cipher.DECRYPT\\_MODE, key);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">SecretKeySpec key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecretKeySpec</span><span style="color:#24292E;">(rawKeyData, DES);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Cipher cipher </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Cipher.</span><span style="color:#6F42C1;">getInstance</span><span style="color:#24292E;">(DES</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ECB</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">PKCS5Padding);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">cipher.</span><span style="color:#6F42C1;">init</span><span style="color:#24292E;">(Cipher.DECRYPT\\_MODE, key);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="开发建议-29" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-29" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>建议使用安全性更高的AES加密算法</p><h3 id="不安全的密钥长度风险" tabindex="-1">不安全的密钥长度风险 <a class="header-anchor" href="#不安全的密钥长度风险" aria-label="Permalink to &quot;不安全的密钥长度风险&quot;">​</a></h3><p>在使用RSA加密时，密钥长度小于512bit，小于512bit的密钥很容易被破解，计算出密钥。</p><h4 id="风险代码-5" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-5" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> KeyPair </span><span style="color:#B392F0;">getRSAKey</span><span style="color:#E1E4E8;">() throws NoSuchAlgorithmException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        KeyPairGenerator keyGen </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> KeyPairGenerator.</span><span style="color:#B392F0;">getInstance</span><span style="color:#E1E4E8;">(RSA);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        keyGen.</span><span style="color:#B392F0;">initialize</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">512</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        KeyPair key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> keyGen.</span><span style="color:#B392F0;">generateKeyPair</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> key;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> KeyPair </span><span style="color:#6F42C1;">getRSAKey</span><span style="color:#24292E;">() throws NoSuchAlgorithmException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        KeyPairGenerator keyGen </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> KeyPairGenerator.</span><span style="color:#6F42C1;">getInstance</span><span style="color:#24292E;">(RSA);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        keyGen.</span><span style="color:#6F42C1;">initialize</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">512</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        KeyPair key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> keyGen.</span><span style="color:#6F42C1;">generateKeyPair</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> key;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="开发建议-30" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-30" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>使用RSA加密时，建议密钥长度大于1024bit</p><h3 id="aes-des弱加密风险-ecb" tabindex="-1">AES/DES弱加密风险（ECB） <a class="header-anchor" href="#aes-des弱加密风险-ecb" aria-label="Permalink to &quot;AES/DES弱加密风险（ECB）&quot;">​</a></h3><p>AES的ECB加密模式容易遭到字典攻击，安全性不够。</p><h4 id="风险代码-6" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-6" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">SecretKeySpec key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecretKeySpec</span><span style="color:#E1E4E8;">(keyBytes, AES);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">Cipher cipher </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Cipher.</span><span style="color:#B392F0;">getInstance</span><span style="color:#E1E4E8;">(AES</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ECB</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">PKCS7Padding, BC);</span><span style="color:#F97583;">**</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">cipher.</span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;">(Cipher.ENCRYPT\\_MODE, key);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">SecretKeySpec key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecretKeySpec</span><span style="color:#24292E;">(keyBytes, AES);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">**</span><span style="color:#24292E;">Cipher cipher </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Cipher.</span><span style="color:#6F42C1;">getInstance</span><span style="color:#24292E;">(AES</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ECB</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">PKCS7Padding, BC);</span><span style="color:#D73A49;">**</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">cipher.</span><span style="color:#6F42C1;">init</span><span style="color:#24292E;">(Cipher.ENCRYPT\\_MODE, key);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="开发建议-31" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-31" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>避免使用ECB模式，建议使用CBC。</p><h3 id="ivparameterspec不安全初始化向量" tabindex="-1">IVParameterSpec不安全初始化向量 <a class="header-anchor" href="#ivparameterspec不安全初始化向量" aria-label="Permalink to &quot;IVParameterSpec不安全初始化向量&quot;">​</a></h3><p>使用IVParameterSpec函数，如果使用了固定的初始化向量，那么密码文本可预测性高得多，容易受到字典攻击等。</p><h4 id="风险代码-7" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-7" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[] iv </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">0x00</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0x00</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0x00</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0x00</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0x00</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0x00</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0x00</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">0x00</span><span style="color:#E1E4E8;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">IvParameterSpec ips </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IvParameterSpec</span><span style="color:#E1E4E8;">(iv)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[] iv </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">0x00</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0x00</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0x00</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0x00</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0x00</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0x00</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0x00</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">0x00</span><span style="color:#24292E;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">IvParameterSpec ips </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IvParameterSpec</span><span style="color:#24292E;">(iv)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="开发建议-32" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-32" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>IVParameterSpec初始化时，不使用常量vector。</p><h3 id="rsa中不使用padding风险" tabindex="-1">RSA中不使用Padding风险 <a class="header-anchor" href="#rsa中不使用padding风险" aria-label="Permalink to &quot;RSA中不使用Padding风险&quot;">​</a></h3><p>使用RSA公钥时通常会绑定一个padding，原因是为了防止一些依赖于no padding时对RSA算法的攻击。</p><h4 id="风险代码-8" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-8" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Cipher rsa </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  rsa </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> javax.crypto.Cipher.</span><span style="color:#B392F0;">getInstance</span><span style="color:#E1E4E8;">(RSA</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">NONE</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">NoPadding);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (java.security.NoSuchAlgorithmException </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (javax.crypto.NoSuchPaddingException </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">SecretKeySpec key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecretKeySpec</span><span style="color:#E1E4E8;">(rawKeyData, RSA);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Cipher cipher </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Cipher.</span><span style="color:#B392F0;">getInstance</span><span style="color:#E1E4E8;">(RSA</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">NONE</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">NoPadding);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">cipher.</span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;">(Cipher.DECRYPT\\_MODE, key);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Cipher rsa </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  rsa </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> javax.crypto.Cipher.</span><span style="color:#6F42C1;">getInstance</span><span style="color:#24292E;">(RSA</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">NONE</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">NoPadding);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (java.security.NoSuchAlgorithmException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (javax.crypto.NoSuchPaddingException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">SecretKeySpec key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecretKeySpec</span><span style="color:#24292E;">(rawKeyData, RSA);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Cipher cipher </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Cipher.</span><span style="color:#6F42C1;">getInstance</span><span style="color:#24292E;">(RSA</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">NONE</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">NoPadding);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">cipher.</span><span style="color:#6F42C1;">init</span><span style="color:#24292E;">(Cipher.DECRYPT\\_MODE, key);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="开发建议-33" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-33" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>建议使用Padding模式。</p><h3 id="keystore弱密码风险" tabindex="-1">KeyStore弱密码风险 <a class="header-anchor" href="#keystore弱密码风险" aria-label="Permalink to &quot;KeyStore弱密码风险&quot;">​</a></h3><p>keytool是一个Java数据证书的管理工具，Keytool将密钥(key，私钥和公钥配对)和证书(certificates)存在一个称为keystore的文件中，并通过密码保护keystore中的密钥。如果密码设置过于简单，例如：123456、android等，则会导致keystore文件的私钥泄露，从而导致一系列的信息泄露风险。</p><h4 id="开发建议-34" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-34" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>提高keystore保护密码的强度</p><h2 id="数据安全" tabindex="-1">数据安全 <a class="header-anchor" href="#数据安全" aria-label="Permalink to &quot;数据安全&quot;">​</a></h2><h3 id="剪贴板敏感信息泄露风险" tabindex="-1">剪贴板敏感信息泄露风险 <a class="header-anchor" href="#剪贴板敏感信息泄露风险" aria-label="Permalink to &quot;剪贴板敏感信息泄露风险&quot;">​</a></h3><p>由于Android剪贴板的内容向任何权限的app开放，很容易就被嗅探泄密。同一部手机中安装的其他app，甚至是一些权限不高的app，都可以通过剪贴板功能获取剪贴板中的敏感信息。</p><h4 id="风险代码-9" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-9" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">clipBtn </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (Button) </span><span style="color:#B392F0;">findViewById</span><span style="color:#E1E4E8;">(R.id.btn\\_clip);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        clipBtn.</span><span style="color:#B392F0;">setOnClickListener</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">OnClickListener</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            @</span><span style="color:#F97583;">Override</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onClick</span><span style="color:#E1E4E8;">(View </span><span style="color:#FFAB70;">v</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                ClipboardManager clipboard </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (ClipboardManager) </span><span style="color:#B392F0;">getSystemService</span><span style="color:#E1E4E8;">(Context.CLIPBOARD\\_SERVICE);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                ClipData clip1 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ClipData.</span><span style="color:#B392F0;">newPlainText</span><span style="color:#E1E4E8;">(label,password</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">123456</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">                clipboard.</span><span style="color:#B392F0;">setPrimaryClip</span><span style="color:#E1E4E8;">(clip1);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        });</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">clipBtn </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (Button) </span><span style="color:#6F42C1;">findViewById</span><span style="color:#24292E;">(R.id.btn\\_clip);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        clipBtn.</span><span style="color:#6F42C1;">setOnClickListener</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">OnClickListener</span><span style="color:#24292E;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onClick</span><span style="color:#24292E;">(View </span><span style="color:#E36209;">v</span><span style="color:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                ClipboardManager clipboard </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (ClipboardManager) </span><span style="color:#6F42C1;">getSystemService</span><span style="color:#24292E;">(Context.CLIPBOARD\\_SERVICE);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                ClipData clip1 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ClipData.</span><span style="color:#6F42C1;">newPlainText</span><span style="color:#24292E;">(label,password</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">123456</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">                clipboard.</span><span style="color:#6F42C1;">setPrimaryClip</span><span style="color:#24292E;">(clip1);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="开发建议-35" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-35" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>避免使用剪贴板敏文存储敏感信息或进行加密</p><h3 id="密钥硬编码风险" tabindex="-1">密钥硬编码风险 <a class="header-anchor" href="#密钥硬编码风险" aria-label="Permalink to &quot;密钥硬编码风险&quot;">​</a></h3><p>在代码中禁止硬编码私钥等敏感信息，攻击者反编译代码，即可拿到。</p><h3 id="intent敏感数据泄露" tabindex="-1">Intent敏感数据泄露 <a class="header-anchor" href="#intent敏感数据泄露" aria-label="Permalink to &quot;Intent敏感数据泄露&quot;">​</a></h3><p>APP创建Intent传递数据到其他Activity，如果创建的Activity不是在同一个Task中打开，就很可能被其他的Activity劫持读取到Intent内容，跨Task的Activity通过Intent传递敏感信息是不安全的。</p><h4 id="开发建议-36" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-36" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>尽量避免使用包含FLAG_ACTIVITY_NEW_TASK标志的Intent来传递敏感信息。</p><h3 id="pendingintent误用风险" tabindex="-1">PendingIntent误用风险 <a class="header-anchor" href="#pendingintent误用风险" aria-label="Permalink to &quot;PendingIntent误用风险&quot;">​</a></h3><p>使用pendingIntent时候，如果使用了一个空Intent，会导致恶意用户劫持Intent的内容。禁止使用空intent去构造pendingIntent。</p><h4 id="开发建议-37" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-37" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>禁止使用空intent去构造pendingIntent。</p><h3 id="数据或程序-dex、so-加载、删除检查" tabindex="-1">数据或程序(DEX、SO)加载、删除检查 <a class="header-anchor" href="#数据或程序-dex、so-加载、删除检查" aria-label="Permalink to &quot;数据或程序(DEX、SO)加载、删除检查&quot;">​</a></h3><p>程序在加载外部dex、so文件是否判断文件来源、是否存放可信区域；程序删除文件是否可篡改文件路劲</p><ol><li>是否加载公共区域程序，如sdcard、/data/local/tmp/、应用自创建但其他应用有读写权限的目录上</li><li>是否从网络下载，检测方法包括：阅读代码、监听网路请求、见识存储区域文件读写、查看安装包</li><li>升级包是否存在公共区域存储。</li></ol><h3 id="文件全局读写漏洞" tabindex="-1">文件全局读写漏洞 <a class="header-anchor" href="#文件全局读写漏洞" aria-label="Permalink to &quot;文件全局读写漏洞&quot;">​</a></h3><p>在使用getDir、getSharedPreferences(SharedPreference)或openFileOutput时，如果设置了全局的可读权限，攻击者恶意读取文件内容，获取敏感信息。在设置文件属性时如果设置全局可写，攻击者可能会篡改、伪造内容，可能会进行诈骗等行为，造成用户财产损失。其中getSharedPreferences如果设置全局写权限，则当攻击app跟被攻击app具有相同的Android:sharedUserId属性时和签名时，攻击app则可以访问到内部存储文件进行写入操作。</p><h4 id="开发建议-38" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-38" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>使用MODE_PRIVATE模式创建内部存储文件</li><li>加密存储敏感数据</li><li>避免在文件中存储明文敏感信息</li><li>避免滥用Android:sharedUserId属性</li></ol><p>如果两个appAndroid:sharedUserId属性相同，切使用的签名也相同，则这两个app可以互相访问内部存储文件数据</p><h3 id="日志泄露风险" tabindex="-1">日志泄露风险 <a class="header-anchor" href="#日志泄露风险" aria-label="Permalink to &quot;日志泄露风险&quot;">​</a></h3><p>在APP的开发过程中，为了方便调试，通常会使用log函数输出一些关键流程的信息，这些信息中通常会包含敏感内容，如执行流程、明文的用户名密码等，这会让攻击者更加容易的了解APP内部结构方便破解和攻击，甚至直接获取到有价值的敏感信息。</p><h4 id="开发建议-39" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-39" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>禁止打印敏感信息</p><h2 id="其他风险" tabindex="-1">其他风险 <a class="header-anchor" href="#其他风险" aria-label="Permalink to &quot;其他风险&quot;">​</a></h2><h3 id="谨慎使用高风险函数" tabindex="-1">谨慎使用高风险函数 <a class="header-anchor" href="#谨慎使用高风险函数" aria-label="Permalink to &quot;谨慎使用高风险函数&quot;">​</a></h3><p>在程序需要执行系统命令等函数，需要谨慎使用，严格控制命令来源，防止黑客替换命令攻击。</p><h4 id="风险代码-10" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-10" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">Example Java code</span><span style="color:#F97583;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  Runtime rr </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Runtime.</span><span style="color:#B392F0;">getRuntime</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  Process p </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> rr.</span><span style="color:#B392F0;">exec</span><span style="color:#E1E4E8;">(ls </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">al);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Example Bytecode code</span><span style="color:#F97583;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const-</span><span style="color:#E1E4E8;">string v2, ls </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">al</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  invoke</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">virtual {v1, v2}, Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Runtime;</span><span style="color:#F97583;">-&gt;</span><span style="color:#B392F0;">exec</span><span style="color:#E1E4E8;">(Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">String;)Ljava</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">lang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Process;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">Example Java code</span><span style="color:#D73A49;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  Runtime rr </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Runtime.</span><span style="color:#6F42C1;">getRuntime</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  Process p </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> rr.</span><span style="color:#6F42C1;">exec</span><span style="color:#24292E;">(ls </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">al);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Example Bytecode code</span><span style="color:#D73A49;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const-</span><span style="color:#24292E;">string v2, ls </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">al</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  invoke</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">virtual {v1, v2}, Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Runtime;</span><span style="color:#D73A49;">-&gt;</span><span style="color:#6F42C1;">exec</span><span style="color:#24292E;">(Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">String;)Ljava</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">lang</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">Process;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="开发建议-40" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-40" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>严格按照要求使用</p><h3 id="fragment注入漏洞-cve-2013-6271" tabindex="-1">Fragment注入漏洞(CVE-2013-6271) <a class="header-anchor" href="#fragment注入漏洞-cve-2013-6271" aria-label="Permalink to &quot;Fragment注入漏洞(CVE-2013-6271)&quot;">​</a></h3><p>在api level 小于19的app，所有继承了PreferenceActivity类的activity并将该类置为exported的应用都受到Fragment注入漏洞的威胁。</p><p>Google在Android 4.4 KitKat 里面修正了该问题，引入了PreferenceActivity.isValidFragment函数，要求用户重写该函数验证Fragment来源正确性。</p><h4 id="开发建议-41" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-41" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>当Android api &gt;=19时，要覆盖每一个PreferenceActivity类下的isValidFragment方法以避免异常抛出；</li><li>当Android api &lt; 19时，如果在PreferenceActivity内没有引用任何fragment，建议覆盖isValidFragment并返回false</li></ol><h4 id="影响范围-6" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围-6" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>小于Android 4.4（API level 19）</p><h3 id="sqlite数据库日志泄露漏洞-cve-2011-3901" tabindex="-1">SQLite数据库日志泄露漏洞(CVE-2011-3901) <a class="header-anchor" href="#sqlite数据库日志泄露漏洞-cve-2011-3901" aria-label="Permalink to &quot;SQLite数据库日志泄露漏洞(CVE-2011-3901)&quot;">​</a></h3><p>Android SQLite数据库journal文件可被所有应用程序读取，所有目录对应程序数据库目录拥有执行权限，意味着应用程序数据目录全局访问，/data/data//databases目录以[rwxrwx--x]权限创建，可导致全局读写。数据库目录下创建的journal文件以[-rw-r--r--]权限创建，可被所有app读取。</p><h4 id="开发建议-42" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-42" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>升级到Android4.0.1以上版本或者使用SQLCipher或其他库加密数据库和日志信息。</p><h4 id="影响范围-7" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围-7" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>Android2.3.7版本存在该漏洞，其他版本可能也受到影响，4.0.1不受影响</p><h3 id="随机数生成漏洞" tabindex="-1">随机数生成漏洞 <a class="header-anchor" href="#随机数生成漏洞" aria-label="Permalink to &quot;随机数生成漏洞&quot;">​</a></h3><p>SecureRandom的使用不当会导致生成的随机数可被预测，该漏洞存在于Android系统随机生成数字串安全密钥的环节中。该漏洞的生成原因是对SecureRandom类的不正确使用方式导致生成的随机数不随机。</p><h4 id="风险代码-11" tabindex="-1">风险代码： <a class="header-anchor" href="#风险代码-11" aria-label="Permalink to &quot;风险代码：&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">SecureRandom secureRandom </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecureRandom</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[] b </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[] { (</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">) </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        secureRandom.</span><span style="color:#B392F0;">setSeed</span><span style="color:#E1E4E8;">(b);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// Prior to Android 4.2, the next line would always return the same number!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        Log.</span><span style="color:#B392F0;">v</span><span style="color:#E1E4E8;">(wgc,</span><span style="color:#F97583;">-------------------------------</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        Log.</span><span style="color:#B392F0;">v</span><span style="color:#E1E4E8;">(wgc,Test1</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> secureRandom.</span><span style="color:#B392F0;">nextInt</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        SecureRandom secureRandom2 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecureRandom</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">[] { (</span><span style="color:#F97583;">byte</span><span style="color:#E1E4E8;">) </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        Log.</span><span style="color:#B392F0;">v</span><span style="color:#E1E4E8;">(wgc,Test2</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> secureRandom2.</span><span style="color:#B392F0;">nextInt</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        SecureRandom secureRandom3 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecureRandom</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        secureRandom3.</span><span style="color:#B392F0;">setSeed</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10L</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        Log.</span><span style="color:#B392F0;">v</span><span style="color:#E1E4E8;">(wgc,Test3</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> secureRandom3.</span><span style="color:#B392F0;">nextInt</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        SecureRandom secureRandom4 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecureRandom</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        secureRandom4.</span><span style="color:#B392F0;">nextBytes</span><span style="color:#E1E4E8;">(b);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        secureRandom4.</span><span style="color:#B392F0;">setSeed</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10L</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        Log.</span><span style="color:#B392F0;">v</span><span style="color:#E1E4E8;">(wgc,Test4</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> secureRandom4.</span><span style="color:#B392F0;">nextInt</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        SecureRandom secureRandom5 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SecureRandom</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        Log.</span><span style="color:#B392F0;">v</span><span style="color:#E1E4E8;">(wgc,Test5</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> secureRandom4.</span><span style="color:#B392F0;">nextInt</span><span style="color:#E1E4E8;">());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">SecureRandom secureRandom </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecureRandom</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[] b </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[] { (</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">) </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        secureRandom.</span><span style="color:#6F42C1;">setSeed</span><span style="color:#24292E;">(b);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// Prior to Android 4.2, the next line would always return the same number!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        Log.</span><span style="color:#6F42C1;">v</span><span style="color:#24292E;">(wgc,</span><span style="color:#D73A49;">-------------------------------</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        Log.</span><span style="color:#6F42C1;">v</span><span style="color:#24292E;">(wgc,Test1</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> secureRandom.</span><span style="color:#6F42C1;">nextInt</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        SecureRandom secureRandom2 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecureRandom</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">[] { (</span><span style="color:#D73A49;">byte</span><span style="color:#24292E;">) </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        Log.</span><span style="color:#6F42C1;">v</span><span style="color:#24292E;">(wgc,Test2</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> secureRandom2.</span><span style="color:#6F42C1;">nextInt</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        SecureRandom secureRandom3 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecureRandom</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        secureRandom3.</span><span style="color:#6F42C1;">setSeed</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10L</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        Log.</span><span style="color:#6F42C1;">v</span><span style="color:#24292E;">(wgc,Test3</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> secureRandom3.</span><span style="color:#6F42C1;">nextInt</span><span style="color:#24292E;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        SecureRandom secureRandom4 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecureRandom</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        secureRandom4.</span><span style="color:#6F42C1;">nextBytes</span><span style="color:#24292E;">(b);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        secureRandom4.</span><span style="color:#6F42C1;">setSeed</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10L</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        Log.</span><span style="color:#6F42C1;">v</span><span style="color:#24292E;">(wgc,Test4</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> secureRandom4.</span><span style="color:#6F42C1;">nextInt</span><span style="color:#24292E;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        SecureRandom secureRandom5 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SecureRandom</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        Log.</span><span style="color:#6F42C1;">v</span><span style="color:#24292E;">(wgc,Test5</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> secureRandom4.</span><span style="color:#6F42C1;">nextInt</span><span style="color:#24292E;">());</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="开发建议-43" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-43" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><ol><li>不要使用自定义随机源代替系统默认随机源（推荐）除非有特殊需求，在使用SecureRandom类时，不要调用以下函数:SecureRandom类下SecureRandom(byte[]seed)、setSeed(long seed)和setSeed(byte[]seed)方法。</li><li>在调用setSeed方法前先调用任意nextXXX方法。具体做法是调用setSeed方法前先调用一次SecureRandom#nextBytes(byte[]bytes)方法，可以避免默认随机源被替代，详细见参考资料。</li></ol><h4 id="影响范围-8" tabindex="-1">影响范围 <a class="header-anchor" href="#影响范围-8" aria-label="Permalink to &quot;影响范围&quot;">​</a></h4><p>Android 4.2之前，Android API 17以后SecureRandom的默认实现方式从Cipher.RSA换到了OpenSSL。SecureRandom新的实现方式不能将自己的seed替换掉系统的seed。</p><h3 id="发布版本需加固" tabindex="-1">发布版本需加固 <a class="header-anchor" href="#发布版本需加固" aria-label="Permalink to &quot;发布版本需加固&quot;">​</a></h3><p>发布的软件，应对app进行加固，防止攻击者获取app代码、业务逻辑、API接口等，对业务和公司声誉造成一定影响，防止app被破解二次打包，导致损失。</p><h4 id="开发建议-44" tabindex="-1">开发建议 <a class="header-anchor" href="#开发建议-44" aria-label="Permalink to &quot;开发建议&quot;">​</a></h4><p>APP加固</p>`,285),o=[p];function r(t,c,i,E,y,d){return a(),n("div",null,o)}const u=s(e,[["render",r]]);export{h as __pageData,u as default};
